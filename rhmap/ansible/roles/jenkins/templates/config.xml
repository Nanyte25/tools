<?xml version='1.0' encoding='UTF-8'?>
<flow-definition plugin="workflow-job@2.3">
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties/>
  <definition class="org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition" plugin="workflow-cps@2.6">
    <script>// CD pipeline for JenkinsCI&#10;
&#10;
node {&#10;
   // Get code from this GitHub repository&#10;
   stage &apos;Code Checkout&apos;&#10;
&#10;
   checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/master&apos;]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: &apos;git-user-credentials&apos;, url: &apos;{{ cloud_git_url.response.gitUrl }}&apos;]]])&#10;
&#10;
   // Install npm dependencies&#10;
   stage &apos;Install Dependencies&apos;&#10;
   sh &apos;/usr/local/bin/npm install&apos;&#10;
&#10;
&#10;
   // Run Tests&#10;
   stage &apos;Run Tests&apos;&#10;
   sh &apos;/usr/local/bin/npm test&apos;&#10;
&#10;
&#10;
   // Configure FHC&#10;
   stage &apos;Configure fhc&apos;&#10;
   sh &apos;fhc target {{ rhmap.domain }}&apos;&#10;
   sh &apos;fhc login {{ rhmap.username }} {{ rhmap.password }}&apos;&#10;
   sh &apos;fhc fhcfg set fhversion 3&apos;&#10;
   sh &apos;fhc fhcfg set version 3&apos;&#10;
&#10;
&#10;
   // Trigger cloud git pull&#10;
   stage &apos;Trigger cloud git pull&apos;&#10;
   sh &apos;/usr/local/bin/fhc git pull {{ cloud_app_guid.response.guid }}&apos;&#10;
&#10;
&#10;
   // Trigger opp stage&#10;
   stage &apos;Trigger cloud app stage&apos;&#10;
   sh &apos;/usr/local/bin/fhc app stage --app={{ cloud_app_guid.response.guid }} --env={{ project_name }}-development&apos;&#10;
&#10;
&#10;
}&#10;</script>
    <sandbox>true</sandbox>
  </definition>
  <triggers/>
</flow-definition>